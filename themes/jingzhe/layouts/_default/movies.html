{{ define "body_classes" }}page-movies{{ end }}
{{ define "main" }}
<div class="pagetitle">自己很喜欢观影，在能力范围内会把显示、音响、播放等设备添置得最好，然后静静的欣赏一部电影一集电视一个故事一段人生～～，沉浸其中体验不同的酸甜苦辣。以下海报墙为已观看或正在追的过程中 ( 数据来源于豆瓣 )～～</div>
  <div id="movies_page" class="fIuTG">
  {{$movies := getCSV "," "data/douban/movie.csv" }}
  {{$scratch := newScratch}}
  {{$scratch.Add "genres" slice}}
  {{range $idx, $movie := $movies}}
    {{if ne $idx 0}}
      {{$scratch.Set "genres" (union ($scratch.Get "genres") (split (index $movie 7) ","))}}
    {{end}}
  {{end}}
   
      {{range $idx, $movie := $movies}}
      {{if ne $idx 0 }}
      <!--封面地址替换 -->
      {{ $yingshiimg := printf "https://img.koobai.com/douban/%s" (path.Base (index $movie 3)) }}
      <!--个人评分改成星星 -->
      {{ $rating := index $movie 8 }}
      <div 
        class="sc-gKAaRy dfdORB img-hide" 
        data-year="{{index $movie 11}}" 
        data-star="{{index $movie 8}}"
        data-rating="{{index $movie 6}}"
        data-genres="{{index $movie 7}}"  
      >
      <div class="sc-hKFxyN HPRth">
          <a rel="link" href="{{index $movie 5}}" target="_blank" > <div class="lazyload-wrapper ">
            <img class="avatar" decoding="async" src="{{ $yingshiimg }}" loading="lazy" alt="{{ index $movie 1 }}">
            </div></a>
            <a rel="link" href="{{index $movie 5}}" target="_blank" >
            <div class="movies-nrong">
            <!--<div class="movie-time">{{index $movie 4}}</div>-->
            <div class="movie-title">{{index $movie 1}}</div>
            <div class="movie-pfeng">
              {{ $starImage := "https://img.koobai.com/star.svg" }}
              {{ with $rating }}
                {{ $ratingCount := . }}
                {{ range $i := seq $ratingCount }}
                  <img src="{{ $starImage }}" />
                {{ end }}
              {{ end }}
            </div>
            <div class="movie-info">{{index $movie 9}}</div>
            <div class="movie-time">@ <script>
              document.write(formatDate({{ index $movie 11 }})); 
         </script></div>
          </div></a>
          </div>
      </div>
      {{end}}
      {{end}}
    </div>  
<div id="movies_loadMore" class="movies_loadMore">看更多...</div>
<!--分页加载更多-->
<script>
  let visibleMovies = 20; // 最初可见的电影数量
  const movies_page = document.getElementById('movies_page');
  const movies_loadMore = document.getElementById('movies_loadMore');

  // 根据可见性计数显示/隐藏电影的函数
  function updateVisibility() {
    const movies = document.querySelectorAll('.sc-gKAaRy.dfdORB.img-hide');
    movies.forEach((movie, idx) => {
      movie.style.display = idx < visibleMovies ? 'block' : 'none';
    });
  }

  // “加载更多”按钮点击事件
  movies_loadMore.addEventListener('click', () => {
    visibleMovies += 20; // 增加可见数量
    updateVisibility(); // 更新电影可见性
  });

  // 初始可见性设置
  updateVisibility();
</script>
<!--分页加载更多结束-->
<div class="article-comments">
  {{- partial "artalk" . -}}
</div>
{{ end }}
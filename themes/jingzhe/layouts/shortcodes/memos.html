<div id="momos-ss"></div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      var bbUrl = "https://memos.koobai.com/api/memo?creatorId=1&rowStatus=NORMAL&limit=4"
      fetch(bbUrl).then(res => res.json()).then(resdata => {
        var result = '';
        var resultAll = "";
        var data = resdata.data;
        for (var i = 0; i < data.length; i++) {
          var bbTime = new Date(data[i].createdTs * 1000).toLocaleString();
          var bbCont = data[i].content;
          var newbbCont = bbCont.replace(/!\[.*?\]\((.*?)\)/g, ' <a href="$1" target="_blank">🌅</a> ').replace(/\[(.*?)\]\((.*?)\)/g, ' <a href="$2" target="_blank">$1</a> ');
          var memo_id = data[i].id;
  
          result += `
              <div class="memos_diaoyong" data-module="fade-in-up">
                <div class="memos-zuoz">
                    <div class="memos-logo"><a href="/memos"><img src='https://img.koobai.com/koobai.svg' alt='koobai' /></a></div>
                        <div>
                            <div class='memos_diaoyong_from'><a href="/memos">koobai</a></div>
                            <span class="memos_diaoyong_time">${bbTime}</span>
                            <span class="memos_diaoyong_laiz"> <a href="/memos">来自唠叨</a></span>
                        </div>
                        <div class="memos-tubiao"><div class='talks_comments'><a href="#" onclick="loadArtalk('${memo_id}')"><i class='fas fa-comment-dots fa-fw'></i><span id='btn_memo_${memo_id}'><svg viewBox="0 0 426.666667 384" xmlns="http://www.w3.org/2000/svg">
                <g fill-rule="evenodd"><path d="M234.666667,0 C340.706133,0 426.666667,85.9613867 426.666667,192 C426.666667,298.039467 340.706133,384 234.666667,384 L21.3333333,384 C9.55136,384 0,374.449067 0,362.666667 L0,192 C0,85.9613867 85.9613867,0 192,0 L234.666667,0 Z M234.666667,42.6666667 L192,42.6666667 C109.525547,42.6666667 42.6666667,109.525547 42.6666667,192 L42.6666667,341.333333 L234.666667,341.333333 C317.141333,341.333333 384,274.474667 384,192 C384,109.525547 317.141333,42.6666667 234.666667,42.6666667 Z M128,170.666667 C139.782187,170.666667 149.333333,180.2176 149.333333,192 C149.333333,203.7824 139.782187,213.333333 128,213.333333 C116.218027,213.333333 106.666667,203.7824 106.666667,192 C106.666667,180.2176 116.218027,170.666667 128,170.666667 Z M213.333333,170.666667 C225.115733,170.666667 234.666667,180.2176 234.666667,192 C234.666667,203.7824 225.115733,213.333333 213.333333,213.333333 C201.550933,213.333333 192,203.7824 192,192 C192,180.2176 201.550933,170.666667 213.333333,170.666667 Z M298.666667,170.666667 C310.449067,170.666667 320,180.2176 320,192 C320,203.7824 310.449067,213.333333 298.666667,213.333333 C286.884267,213.333333 277.333333,203.7824 277.333333,192 C277.333333,180.2176 286.884267,170.666667 298.666667,170.666667 Z" fill-rule="nonzero"></path></g></svg>
                </span></a></div></div>
                </div>
                    <div class="memos_diaoyong_info">${newbbCont}</div>
                    <div id='memo_${memo_id}' class='artalk hidden'></div>
              </div>`;
        }
  
        var bbDom = document.querySelector('#momos-ss');
        var bbBefore = `<div class="momos-sswrap"><ul class="momos-sslist">`;
        var bbAfter = `</ul></div>`;
        resultAll = bbBefore + result + bbAfter;
        bbDom.innerHTML = resultAll;
  
        // 相对时间
        window.Lately && Lately.init({ target: '.memos_diaoyong_time' });
  
        // 添加 loadArtalk 函数
        function loadArtalk(memo_id) {
          const commentDiv = document.getElementById('memo_' + memo_id);
          const commentBtn = document.getElementById('btn_memo_' + memo_id);
          if (commentDiv.classList.contains('hidden')) {
            commentDiv.classList.remove('hidden');
            commentBtn.innerHTML = '<svg viewBox="0 0 426.666667 384" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><path d="M234.666667,0 C340.706133,0 426.666667,85.9613867 426.666667,192 C426.666667,298.039467 340.706133,384 234.666667,384 L21.3333333,384 C9.55136,384 0,374.449067 0,362.666667 L0,192 C0,85.9613867 85.9613867,0 192,0 L234.666667,0 Z M234.666667,42.6666667 L192,42.6666667 C109.525547,42.6666667 42.6666667,109.525547 42.6666667,192 L42.6666667,341.333333 L234.666667,341.333333 C317.141333,341.333333 384,274.474667 384,192 C384,109.525547 317.141333,42.6666667 234.666667,42.6666667 Z M128,170.666667 C139.782187,170.666667 149.333333,180.2176 149.333333,192 C149.333333,203.7824 139.782187,213.333333 128,213.333333 C116.218027,213.333333 106.666667,203.7824 106.666667,192 C106.666667,180.2176 116.218027,170.666667 128,170.666667 Z M213.333333,170.666667 C225.115733,170.666667 234.666667,180.2176 234.666667,192 C234.666667,203.7824 225.115733,213.333333 213.333333,213.333333 C201.550933,213.333333 192,203.7824 192,192 C192,180.2176 201.550933,170.666667 213.333333,170.666667 Z M298.666667,170.666667 C310.449067,170.666667 320,180.2176 320,192 C320,203.7824 310.449067,213.333333 298.666667,213.333333 C286.884267,213.333333 277.333333,203.7824 277.333333,192 C277.333333,180.2176 286.884267,170.666667 298.666667,170.666667 Z" fill-rule="nonzero"></path></g></svg>';
            const artalk = new Artalk({
              el: '#memo_' + memo_id,
              pageKey: '/m/' + memo_id,
              pageTitle: '',
              server: 'https://c.koobai.com/',
              site: '空白唠叨',
              darkMode: 'auto'
            });
          } else {
            commentDiv.classList.add('hidden');
            commentBtn.innerHTML = '<svg viewBox="0 0 426.666667 384" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><path d="M234.666667,0 C340.706133,0 426.666667,85.9613867 426.666667,192 C426.666667,298.039467 340.706133,384 234.666667,384 L21.3333333,384 C9.55136,384 0,374.449067 0,362.666667 L0,192 C0,85.9613867 85.9613867,0 192,0 L234.666667,0 Z M234.666667,42.6666667 L192,42.6666667 C109.525547,42.6666667 42.6666667,109.525547 42.6666667,192 L42.6666667,341.333333 L234.666667,341.333333 C317.141333,341.333333 384,274.474667 384,192 C384,109.525547 317.141333,42.6666667 234.666667,42.6666667 Z M128,170.666667 C139.782187,170.666667 149.333333,180.2176 149.333333,192 C149.333333,203.7824 139.782187,213.333333 128,213.333333 C116.218027,213.333333 106.666667,203.7824 106.666667,192 C106.666667,180.2176 116.218027,170.666667 128,170.666667 Z M213.333333,170.666667 C225.115733,170.666667 234.666667,180.2176 234.666667,192 C234.666667,203.7824 225.115733,213.333333 213.333333,213.333333 C201.550933,213.333333 192,203.7824 192,192 C192,180.2176 201.550933,170.666667 213.333333,170.666667 Z M298.666667,170.666667 C310.449067,170.666667 320,180.2176 320,192 C320,203.7824 310.449067,213.333333 298.666667,213.333333 C286.884267,213.333333 277.333333,203.7824 277.333333,192 C277.333333,180.2176 286.884267,170.666667 298.666667,170.666667 Z" fill-rule="nonzero"></path></g></svg>';
          }
        }
  
        // 获取所有评论按钮，并添加点击事件监听器
        var commentButtons = document.querySelectorAll('.talks_comments a');
        commentButtons.forEach(function(button) {
          button.addEventListener('click', function(event) {
            event.preventDefault();
            var memo_id = this.getAttribute('onclick').match(/loadArtalk\('(.*)'\)/)[1];
            loadArtalk(memo_id);
          });
        });
      });
    });
  </script>
<script type="text/javascript" src="/js/lately.min.js"></script>
<!-- CSS -->
<link href="https://npm.elemecdn.com/artalk@2.5.5/dist/ArtalkLite.css" rel="stylesheet">

<!-- JS -->
<script src="https://npm.elemecdn.com/artalk@2.5.5/dist/ArtalkLite.js"></script>